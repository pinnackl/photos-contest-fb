<link rel="import" href="../../vendor/polymer/polymer.html">
<link rel="import" href="../../vendor/firebase-element/firebase-collection.html">

<dom-module id="contest-data">
	<template>
		<style>
		:host {
			display: block;
		}
		</style>
		<iron-localstorage name="app-storage" value="{{_storage}}"></iron-localstorage>
		<firebase-collection data="{{data}}"
							 location="{{userLocation}}"
							 on-firebase-value="_firebaseLoaded">
		</firebase-collection>
	</template>
	<script>
		Polymer({
			is: 'contest-data',
			properties: {
				location: {
					type: String
				},
				userLocation: {
					type: String,
					notify: true
				},
				fireUser: {
					observer: '_userChanged'
				},
				ref: {
					notify: true,
					observer: '_refChanged'
				},
				data: {
					notify: true,
					observer: '_dataChanged'
				},
				_storage: {
					notify: true,
					observer: '_storageChanged'
				}
			},
			_userChanged: function (user) {
				if (user) {
					var uid = this.fireUser.uid;
						uid = uid.replace(":", "%3A");
					this.userLocation = [this.location, 'users', uid].join('/');
				}
			},
			_refChanged: function (ref) {
				// console.log(ref);
			},
			_dataChanged: function (data) {
				// console.log(data);
			},
			_firebaseLoaded: function (e) {
				this.data = this.data.slice();
			},
			_storageChanged: function (_storage) {
				if (_storage != null && _storage.hasOwnProperty('firebase')) {
					this.location = _storage.firebase;
				}
			}
		});
	</script>
</dom-module>