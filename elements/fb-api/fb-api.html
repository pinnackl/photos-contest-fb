<link rel="import" href="../../vendor/polymer/polymer.html">
<link rel="import" href="../../vendor/iron-ajax/iron-ajax.html">

<dom-module id="fb-api">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>
		<iron-ajax
		 	auto
		 	url="../../config/config.json"
		 	handle-as="json"
		 	on-response="handleResponse"></iron-ajax>
	</template>
	<script>
		Polymer({
			is: 'fb-api',
			properties: {
				appid: {
					type: String
				}
			},
			handleResponse: function (e) {
				window.config = e.detail.response;

				window.fbAsyncInit = function() {
					FB.init({
						appId      : window.config.appId,
						xfbml      : true,
						version    : 'v2.5'
					});

					function onLogin(response) {
						if (response.status == 'connected') {
							FB.api('/me?fields=first_name', function(data) {
							  // test purpose ...
					  			var welcomeBlock = document.getElementById('index');
					  			welcomeBlock.innerHTML = 'Hello, ' + data.first_name + '!';
							});
						}
					}

					FB.getLoginStatus(function(response) {
				  		// Check login status on load, and if the user is
				  		// already logged in, go directly to the welcome message.
				  		if (response.status == 'connected') {
				  			onLogin(response);
				  		} else {
				    		// Otherwise, show Login dialog first.
				    		FB.login(function(response) {
				    			onLogin(response);
				    		}, {scope: 'user_friends, email'});
						}
					});
				};

				(function(d, s, id){
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) {return;}
					js = d.createElement(s); js.id = id;
					js.src = "//connect.facebook.net/en_US/sdk.js";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));
			},
			ready: function (argument) {
			}
		});
	</script>
</dom-module>