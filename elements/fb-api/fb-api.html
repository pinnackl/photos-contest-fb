<link rel="import" href="../../vendor/polymer/polymer.html">
<link rel="import" href="../../vendor/iron-ajax/iron-ajax.html">

<dom-module id="fb-api">
	<template>
		<style>
			:host {
				display: block;
			}
		</style>
		<iron-ajax
		 	auto
		 	url="../../config/config.json"
		 	handle-as="json"
		 	on-response="handleResponse"></iron-ajax>
		<iron-localstorage id="ls" name="app-storage" value="{{config}}" on-iron-localstorage-load-empty="_initLocalStorage"></iron-localstorage>
	</template>
	<script>
		Polymer({
			is: 'fb-api',
			properties: {
				config: {
					type: Object,
					notify: true
				},
				loaded: {
					type: String,
					value: 'false',
					notify: true
				}
			},
			handleResponse: function (e) {
				var fbApi = this;
				fbApi.$.ls.reload();
				var tmp = Object.assign(fbApi.config, e.detail.response);
				fbApi.set('config', {});
				fbApi.set('config', tmp);

				window.fbAsyncInit = function() {
					FB.init({
						appId      : fbApi.config.appId,
						xfbml      : true,
						version    : 'v2.5'
					});

					fbApi.loaded = 'true';
					fbApi.fire('fb-ready');
				};

				(function(d, s, id){
					var js, fjs = d.getElementsByTagName(s)[0];
					if (d.getElementById(id)) {return;}
					js = d.createElement(s); js.id = id;
					js.src = "//connect.facebook.net/en_US/sdk.js";
					fjs.parentNode.insertBefore(js, fjs);
				}(document, 'script', 'facebook-jssdk'));				
			},
			ready: function (argument) {
			},
			_initLocalStorage: function () {
				this.storage = {};
			}

		});
	</script>
</dom-module>