<link rel="import" href="../../vendor/polymer/polymer.html">
<link rel="import" href="../../vendor/paper-button/paper-button.html">
<link rel="import" href="../../vendor/iron-icon/iron-icon.html">

<dom-module id="fb-login">
	<template>
		<style>
			/* FIXME : use custom variable to change properties */
			:host {
				display: inline-block;
				@apply(--fb-login-container-theme);
			}

			:host paper-button {
				/*Shadow properties*/
				color: 				var(--fb-login-color, #FFFFFF);
				background-color: 	var(--fb-login-bg-color, #3B579D);
				font-weight:		var(--fb-login-fw, bold);				
			}

			paper-button {
				/*Mixin to define custom theme*/
				@apply(--fb-login-theme);
			}

			.icon {
			    --iron-icon-height: 32px;
			    --iron-icon-width: 32px;
			}
		</style>
		<paper-button raised
			on-tap="login">
			<iron-icon class="icon" src="../../img/FB-f-Logo__blue_50.png"></iron-icon>
			Login</paper-button>
	</template>
	<script>
		Polymer({
			is: 'fb-login',
			properties: {
				// Determine if the login action is automatically call
				// NOTE : If declared the test is true
				autoLogin: {
					type: Boolean,
					value: false,
					observer: "_apiObserver"
				},
				// Graph API URL to call to get data
				graphUrl: {
					type: String,
					value: ""
				},
				// Scope param of permission to ask for
				scope: {
					type: String,
					value: "public_profile"
				},
				// Graph API Response Object
				response: {
					type: Object,
					notify: true
				}
			},
			checkLoginStatus: function () {
				var fbLogin = this;
				FB.getLoginStatus(function(response) {
			 		// Check login status on load, and if the user is already logged in
			 		if (response.status == 'connected') {
			 			fbLogin._customLoginAction(response);
			 		} else if (fbLogin.autoLogin) {
				   		// Otherwise, show Login dialog first.
				   		fbLogin.login();
					}
				});
			},
			login: function () {
				var fbLogin = this;
				FB.login(function(response) {
					fbLogin._customLoginAction(response);
				}, {scope: fbLogin.scope});
			},
			_apiObserver: function  () {
				if (this.autoLogin) {
					this.checkLoginStatus();
				}
			},
			_customLoginAction: function (response) {
				var fbLogin = this;
				if (response.status == 'connected') {
					FB.api('/' + fbLogin.graphUrl, function(data) {
						fbLogin.response = data;
					});
				} else {
					console.log("Canceled");
				}
			},
		});
	</script>
</dom-module>