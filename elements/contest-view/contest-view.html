<link rel="import" href="../../vendor/polymer/polymer.html">
<link rel="import" href="../../vendor/paper-toast/paper-toast.html">
<link rel="import" href="../fb-login/fb-login.html">
<link rel="import" href="../contest-data/contest-data.html">

<dom-module id="contest-view">
	<template>
		<style>
			:host {
				display: block;
				height: 100%;
			}
		    .container {
		        width: 80%;
		        margin: 50px auto;
		    }

		    .avatar {
		    	border-radius: 50%;
		    }
		</style>
		<contest-data 	id="data"
						fire-user="{{user}}"
						ref="{{ref}}"
						data="{{data}}"
						location="https://blinding-inferno-401.firebaseio.com/">
		</contest-data>
		<paper-header-panel class="flex">
		    <paper-toolbar>
				<paper-icon-button icon="menu" on-tap="menuAction"></paper-icon-button>
				<div>
					<template is="dom-if" if={{resp.picture.data.url}}>
						<img class="avatar" src="[[resp.picture.data.url]]" alt="Avatar">
					</template>
				</div>
				<div class="title">[[resp.name]]</div>
				<paper-icon-button icon="more-vert" on-tap="moreAction"></paper-icon-button>
		    </paper-toolbar>
			<paper-toast id="message"
				text="You must be loged in to use this app"
				duration="5000">
			</paper-toast>
			<iron-pages selected="0">
				<div id="index">
					<div class="container">
						<fb-login
							id="loginbtn1"
							graph-url="me?fields=name"
							scope="public_profile, email, user_photos"
							response="{{resp}}"
							fire-user="{{user}}"
							ref="{{ref}}"
							on-response-changed="test"
							on-fb-login-success="loginSuccess"
							on-fb-login-canceled="loginCancel">
						</fb-login>
						<!-- <fb-login
							id="loginbtn2"
							graph-url="me?fields=name, id"
							scope="public_profile, email, user_photos"
							response="{{resp}}"
							on-fb-login-canceled="loginCancel">
						</fb-login> -->
						<photo-list id="photoList"></photo-list>
							<!-- <template is="dom-repeat" items="[[data]]" as="item">
								<h4>Name : [[item.value]] </h4>
							</template> -->
					</div>
				</div>
				<div></div>
				<div></div>
			</iron-pages>
		</paper-header-panel>
	</template>
	<script>
		Polymer({
			is: 'contest-view',
			properties: {
				apiLoaded: {
					type: String,
					value: 'false',
					notify: true,
					observer: '_apiLoaded'
				},
				autoLogin: {
					type: Boolean,
					value: false
				},
				photos: {
					type: Array,
					notify: true
				}
			},
			// Property "apiLoaded" observer
			_apiLoaded: function (n, o) {
				if (n === 'true') {
					this.$.loginbtn1.apiLoaded = true;
					// this.$.loginbtn2.apiLoaded = true;
				}
			},
			loginSuccess: function () {
				this.$.photoList.apiLoaded = true;
			},
			loginCancel: function () {
				this.$.message.open();
			},
			test: function (e) {
				// console.log(e.detail.value);
				// this.$.data.push('data', {});
			}
		});
	</script>
</dom-module>